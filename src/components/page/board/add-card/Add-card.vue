<template>
    <div class="board-add-card">
        <div class="board-card" v-if="showCard" v-click-outside="hide">
            <div class="card-body">
                <div class="card-title">
                    <input 
                        v-model="title"
                        type="text" 
                        placeholder="Напишите название задачи" 
                        class="card-title-input"
                        ref="input"/>
                </div>
                <div :class="['card-compleet']"></div>
            </div>
            <div class="card-bottom">
                <Assignee
                    :assignee="assignee"
                    :updateParam="updateParam">
                </Assignee>
                <Calendar 
                    :updateParam="updateParam"
                    :deadline="deadline">
                </Calendar>
                <Projects 
                    :project="project"
                    :updateParam="updateParam">
                </Projects>
            </div>
        </div>
        <div class="card-add-button" @click="addCard" v-if="!showCard">
            <i class="fa-solid fa-plus"></i>Добавить задачу
        </div>
    </div>
    
</template>

<script>
    import ClickOutside from 'v-click-outside';
    import Calendar from './../card-detail/calendar/Calendar.vue';
    import Assignee from './../card-detail/assignee/Assignee.vue';
    import Projects from './../card-detail/projects/Projects.vue';

    export default {
        name: 'Add-card',
        data: function() {
            return {
                showCard: false,
                title: '',
                deadline: null,
                assignee: null,
                project: null
            }
        },
        props: {
            listName: String
        },
        directives: {
            clickOutside: ClickOutside.directive
        },
        components: {
            Calendar,
            Assignee,
            Projects
        },
        computed: {
            user() {
                return this.$store.state.user;
            },
            activeUser() {
                return this.$store.state.activeUser;
            },
            activeProject() {
                return this.$store.state.activeProject;
            }
        },
        methods: {
            addCard() {
                this.showCard = true;
                this.$nextTick(() => {
                    this.$refs.input.focus();
                });
            },
            hide() {
                if (this.title.length > 0) {
                    this.$store.commit('addCard', {
                        card: {
                            title: this.title,
                            column: this.listName,
                            project: this.project,
                            created_by: this.user,
                            assignee: this.assignee,
                            deadline: this.deadline,
                            column: this.listName,
                            ready: false, 
                            description: "",
                            journal: {
                                items: []
                            }
                        },
                    });
                }
                this.title = '';
                this.showCard = false;
            },
            updateParam(newValue, param) {
                this[param] = newValue;
            },
        },
        mounted() {
            
        }
    }
</script>
